--Storage Setting

-- Policy 1: 참여자와 요청자가 proof 이미지 읽을 수 있게
-- Policy Name: Participants and Requesters can read proofs
-- Action: SELECT
-- Target Role: authenticated
-- Policy Definition
auth.uid() = owner
OR EXISTS (
  SELECT 1
  FROM participations
  JOIN requests ON participations.request_id = requests.id
  WHERE participations.proof_url = storage.objects.name
    AND requests.owner_id = auth.uid()
)

-- Policy 2: 업로드 허용 (본인이 올린 파일만)
-- Policy Name: Allow authenticated users to upload images
-- Action: INSERT
-- Target Role: authenticated
-- Policy Definition
auth.uid() = owner

-- Policy 3: 삭제 허용 (본인이 올린 파일만)
-- Policy Name: Allow authenticated users to delete images
-- Action: DELETE
-- Target Role: authenticated
-- Policy Definition
auth.uid() = owner